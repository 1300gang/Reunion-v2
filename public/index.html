<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jeu Questions Ramifiées - Sensibilisation LGBTQIA+</title>
  
  <!-- Préconnexion pour optimiser le chargement des polices -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Import de la police Inter (fallback) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Feuilles de style refondues -->
  <link rel="stylesheet" href="styles/satoshi.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles/vote-component.css">
  <link rel="stylesheet" href="styles/chapter-menu.css">
  
  <!-- Ajout de la police Mefta -->
  <style>
    @font-face {
      font-family: 'Mefta';
      src: url('fonts/Mefta-Regular.woff2') format('woff2'),
           url('fonts/Mefta-Regular.woff') format('woff');
      font-weight: 400;
      font-display: swap;
    }
    @font-face {
      font-family: 'Mefta';
      src: url('fonts/Mefta-Bold.woff2') format('woff2'),
           url('fonts/Mefta-Bold.woff') format('woff');
      font-weight: 700;
      font-display: swap;
    }
  </style>
</head>
<body>
  <!-- Texture de fond papier -->
  <div class="paper-texture-overlay"></div>
  
  <!-- Écran Intervenant - Création -->
  <div id="intervenant-screen" class="screen">
    <div class="container">
      <div class="pill">
        <span class="pill-icon">🎓</span>
        <span>Mode Intervenant</span>
      </div>
      
      <div id="intervenant-creation" class="card institutional-card">
        <h2 class="card-title">Bienvenue dans le mode Intervenant</h2>
        <div class="brief">
          <p><strong>Votre rôle :</strong> Vous allez animer une session interactive où les participants répondront à des questions sur des scénarios mettant en scène Gaëtan et Nicolas.</p>
          <p><strong>Comment ça marche :</strong> Créez une partie, partagez le code avec les participants, et guidez-les à travers les différentes situations éducatives.</p>
          <p class="brief-note">Ce jeu sérieux aborde les thèmes de l'orientation sexuelle, de l'identité de genre et de la lutte contre les discriminations.</p>
        </div>
        
        <div class="form-group">
          <label for="lobbyNameInput">Nom de la partie</label>
          <input type="text" id="lobbyNameInput" placeholder="Ex: Classe 3B" maxlength="30" class="input-institutional">
        </div>
        
        <button id="createLobbyBtn" class="button button-primary">
          <span>Créer la partie</span>
        </button>
      </div>

      <div id="intervenant-lobby" class="hidden">
        <div class="card institutional-card">
          <div class="pill">
            <span class="pill-icon">🎓</span>
            <span id="lobbyNameDisplay"></span>
          </div>
                      <div id="qr-overlay" class="qr-overlay">
              <div class="qr-section">
                <h3 class="qr-title">Invitez les participants</h3>
                <div id="qrcode" class="qr-container"></div>
                <button id="copyLinkBtn" class="button button-secondary button-small">
                  <span>📋</span>
                  <span>Copier le lien</span>
                </button>
              </div>
            </div>
          <!-- Container pour l'image ou le menu des chapitres -->
          <div class="image-container">
            <img id="contextImage" src="img/img_contextuel/nico_gaetan_marche_des_fierte.png" alt="Contexte" class="context-image">

          </div>
          
          <div id="participants-section" class="participants-section">
            <h4>Participants (<span id="playerCount">0</span>)</h4>
            <div id="playersList" class="players-pills"></div>
            <div id="waitingForVotes" class="waiting-votes hidden">
              <div class="waiting-indicator"></div>
              <span>En attente de réponse : <span id="pendingPlayers"></span></span>
            </div>
          </div>
          
          <button id="startGameBtn" class="button button-primary" disabled>
            <span id="startBtnText">Commencer la partie</span>
            <span id="minPlayersText" class="min-players-info">(min. 1 joueur requis)</span>
          </button>
        </div>

        <div id="game-control" class="hidden">
          <div class="card institutional-card">
            <div class="pill">
              <span class="pill-icon">🎓</span>
              <span id="lobbyNameGame"></span>
            </div>
            
            <div class="image-placeholder">
              <img id="questionImage" src="img/img_contextuel/nico_gaetan_marche_des_fierte.png" alt="Contexte" class="question-image">
            </div>
            
            <div class="question-section">
              <h3 id="questionTitle" class="question-title">Question en cours</h3>
              <p id="questionContext" class="question-context"></p>
            </div>
            
            <div id="waitingForVotesGame" class="waiting-votes">
              <div class="waiting-indicator"></div>
              <span>En attente de : <span id="pendingPlayersGame"></span></span>
            </div>
            
            <div id="votingOptions" class="voting-options"></div>
            
            <div class="control-buttons">
              <button id="endGameBtn" class="button button-danger">
                <span>🏁</span>
                <span>Terminer</span>
              </button>
              <button id="generateCsvBtn" class="button button-secondary">
                <span>📊</span>
                <span>Exporter CSV</span>
              </button>
            </div>
            
            <a id="csvDownloadLink" class="hidden button button-primary">
              <span>📄</span>
              <span>Télécharger les résultats</span>
            </a>
          </div>
        </div>
        
        <div id="game-over-gm" class="hidden">
          <div class="card institutional-card">
            <div class="pill">
              <span class="pill-icon">✅</span>
              <span id="lobbyNameEnd"></span> - Terminée
            </div>
            
            <h2 class="end-title">Session terminée avec succès</h2>
            
            <div class="stats-section">
              <h3>📊 Points de difficulté identifiés</h3>
              <div id="difficultyPoints" class="difficulty-cards"></div>
            </div>
            
            <div class="observations-section">
              <h3>💭 Vos observations</h3>
              <textarea id="gmObservations" rows="5" placeholder="Notez vos impressions sur la session..." class="textarea-institutional"></textarea>
            </div>
            
            <div class="final-actions">
              <button id="finalDownloadCsvBtn" class="button button-primary">
                <span>📊</span>
                <span>Télécharger CSV</span>
              </button>
              <button id="sendResultsBtn" class="button button-secondary" disabled>
                <span>📧</span>
                <span>Envoyer résultats</span>
              </button>
              <button id="newSessionBtn" class="button">
                <span>🔄</span>
                <span>Nouvelle session</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Écran Joueur -->
  <div id="player-screen" class="screen">
    <div class="container">
      <div id="player-join" class="card institutional-card hidden">
        <div class="pill">
          <span class="pill-icon">🎮</span>
          <span>Mode Joueur</span>
        </div>
        <h2 class="card-title">Rejoindre une partie</h2>
        
        <div class="form-group">
          <label for="lobbyCodeInput">Code de la partie</label>
          <input type="text" id="lobbyCodeInput" placeholder="Entrez le code" class="input-institutional">
        </div>
        
        <button id="joinLobbyBtn" class="button button-primary">
          <span>Rejoindre</span>
        </button>
      </div>

      <div id="player-info" class="card institutional-card">
        <div class="pill">
          <span class="pill-icon">🎮</span>
          <span id="playerLobbyName">Partie</span>
        </div>
        <h2 class="card-title">Vos informations</h2>
        
        <form id="playerInfoForm">
          <div class="form-group">
            <label for="playerPrenom">Prénom</label>
            <input type="text" id="playerPrenom" required maxlength="20" class="input-institutional">
          </div>
          
          <div class="form-group">
            <label for="playerAge">Âge</label>
            <input type="number" id="playerAge" min="10" max="99" required class="input-institutional">
          </div>
          
          <div class="form-group">
            <label for="playerGenre">Genre</label>
            <select id="playerGenre" required class="select-institutional">
              <option value="">Sélectionnez</option>
              <option value="Fille">Fille</option>
              <option value="Garçon">Garçon</option>
              <option value="Autre">Autre</option>
              <option value="Ne souhaite pas répondre">Ne souhaite pas répondre</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="playerEcole">École</label>
            <input type="text" id="playerEcole" required maxlength="50" class="input-institutional">
          </div>
          
          <div class="button-group">
            <button type="button" id="randomFillBtn" class="button button-secondary">
              <span>🎲</span>
              <span>Remplir aléatoirement</span>
            </button>
            <button type="submit" class="button button-primary">
              <span>Commencer</span>
            </button>
          </div>
        </form>
      </div>

      <div id="player-waiting" class="hidden card institutional-card">
        <div class="pill">
          <span class="pill-icon">🎮</span>
          <span id="waitingLobbyName">Partie</span>
        </div>
        <div class="waiting-content">
          <div class="loader institutional-loader"></div>
          <h2>En attente...</h2>
          <p>L'intervenant va bientôt lancer la partie</p>
        </div>
      </div>

      <div id="player-game" class="hidden">
        <div class="pill floating-pill">
          <span class="pill-icon">🎮</span>
          <span id="gameLobbyName">Partie</span>
        </div>
        
        <div class="game-content">
          <div class="image-placeholder">
            <img id="playerContextImage" src="img/img_contextuel/nico_gaetan_marche_des_fierte.png" alt="Contexte" class="context-image">
          </div>
          
          <div id="playerQuestionContext" class="context-box"></div>
          
          <div id="messengerView" class="messenger-container">
            <div class="typing-indicator hidden">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          
          <button id="showAnswersBtn" class="answer-toggle">
            <span>Répondre</span>
            <span class="arrow">↑</span>
          </button>
        </div>
        
        <div id="answerPanel" class="answer-panel">
          <div id="waitingMessage" class="waiting-message-panel hidden">
            <div class="waiting-indicator"></div>
            <span>En attente des autres joueurs et du maître du jeu...</span>
          </div>
          <div class="answer-panel-header">
            <h3 id="playerQuestionTitle">Que faire ?</h3>
            <button id="closeAnswersBtn" class="close-btn">×</button>
          </div>
          <div id="answerChoices" class="answer-choices"></div>
          <p id="answerStatus" class="answer-status"></p>
        </div>
      </div>

      <div id="player-game-over" class="hidden card institutional-card">
        <div class="pill">
          <span class="pill-icon">✅</span>
          <span>Partie terminée</span>
        </div>
        
        <h2 class="end-title">Merci d'avoir participé !</h2>
        
        <div class="feedback-section">
          <h3>💭 Avez-vous des observations à partager ?</h3>
          <textarea id="playerFeedback" rows="4" placeholder="Vos impressions, difficultés rencontrées..." class="textarea-institutional"></textarea>
        </div>
        
        <div class="final-actions">
          <button id="sendFeedbackBtn" class="button button-primary">
            <span>Envoyer mon feedback</span>
          </button>
          <button id="backToHomeBtn" class="button button-secondary">
            <span>Retour à l'accueil</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay de texture papier global -->
  <style>
    .paper-texture-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('img/painted-relief-texture.jpg');
      background-size: cover;
      opacity: 0.03;
      mix-blend-mode: multiply;
      pointer-events: none;
      z-index: 9999;
    }
    
    .institutional-card {
      position: relative;
      overflow: visible;
    }
    
    .institutional-card::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, 
        var(--couleur-jaunePeps) 0%, 
        transparent 30%, 
        transparent 70%, 
        var(--couleur-grisBleuClair) 100%
      );
      border-radius: 14px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .institutional-card:hover::after {
      opacity: 0.2;
    }
    
    .waiting-indicator {
      width: 8px;
      height: 8px;
      background: var(--couleur-jaunePeps);
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }
    
    .institutional-loader {
      border-color: var(--couleur-beigeNorm);
      border-top-color: var(--couleur-jaunePeps);
    }
    
    .floating-pill {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      box-shadow: var(--effet-grosDropShadow);
    }
    
    .pill-icon {
      font-size: 1.1rem;
    }
  </style>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <script src="scripts/vote-component.js"></script>
  <script src="scripts/chapter-menu.js"></script>
  <script src="script.js"></script>
</body>
</html>